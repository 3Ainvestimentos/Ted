rules_version = '2';

service cloud.firestore {
  match /databases/{database}/documents {

    // Regra geral: por padrão, apenas usuários autenticados podem acessar os dados.
    // Isso bloqueia todo o acesso anônimo.
    match /{document=**} {
      allow read, write: if request.auth != null;
    }

    // Regras específicas por coleção para maior granularidade (opcional, mas recomendado)
    // Assegura que apenas usuários logados acessem as coleções principais.

    match /initiatives/{initiativeId} {
      allow read, write: if request.auth != null;
    }

    match /collaborators/{collaboratorId} {
      allow read, write: if request.auth != null;
    }

    match /recurringMeetings/{meetingId} {
      allow read, write: if request.auth != null;
    }

    match /businessAreas/{areaId} {
      allow read, write: if request.auth != null;
    }

    match /okrs/{okrId} {
      allow read, write: if request.auth != null;
    }

    match /kpis/{kpiId} {
      allow read, write: if request.auth != null;
    }

    match /settings/{settingId} {
      // Configurações podem ser sensíveis. Apenas administradores deveriam ter acesso.
      // Adicionaremos uma lógica de "roles" (funções) aqui em um próximo passo.
      // Por enquanto, permitimos acesso a usuários logados.
      allow read, write: if request.auth != null;
    }

    match /notes/{userId} {
      // Um usuário só pode ler ou escrever suas próprias notas.
      allow read, write: if request.auth != null && request.auth.uid == userId;
    }

    match /tasks/{taskId} {
      // Um usuário só pode interagir com suas próprias tarefas.
      allow read, write: if request.auth != null && request.auth.uid == resource.data.userId;
    }
  }
}
